var selectedFormButton = void 0,
    selectedFormID = void 0;
document.addEventListener("DOMContentLoaded", function() {
    var a = document.getElementById("zapTatkal");
    a && a.addEventListener("change", enableDisableZapTatkal);
    (a = document.getElementById("refresh")) && a.addEventListener("change", handleAutomaticRefresh);
    (a = document.getElementById("editForm")) && a.addEventListener("click", openOrFocusEditDetailsPage);
    (a = document.getElementById("irctcLink")) && a.addEventListener("click", function() {
        window.open("https://www.irctc.co.in", "_blank")
    });
    chrome.storage.local.get("irctcZapTatkalEnable",
        initializeZapTatkal);
    chrome.storage.local.get("irctcZapTatkalRefresh", initializeAutoRefresh);
    chrome.storage.local.get("selectedForm", initializeForm)
});

function enableDisableZapTatkal() {
    var a = document.getElementById("zapTatkal");
    a && chrome.storage.local.set({
        irctcZapTatkalEnable: a.checked
    })
}

function handleAutomaticRefresh() {
    var a = document.getElementById("refresh");
    a && chrome.storage.local.set({
        irctcZapTatkalRefresh: a.checked
    })
}

function openOrFocusEditDetailsPage() {
    chrome.extension.getURL("editDetails.html");
    chrome.tabs.query({}, function() {
        chrome.tabs.create({
            url: "editDetails.html"
        })
    })
}

function initializeZapTatkal(a) {
    var b = !1;
    a && (b = a.irctcZapTatkalEnable);
    if (a = document.getElementById("zapTatkal"))
        void 0 == b ? (chrome.storage.local.set({
            irctcZapTatkalEnable: !0
        }), a.checked = !0) : a.checked = b ? !0 : !1
}

function initializeAutoRefresh(a) {
    var b = !1;
    a && (b = a.irctcZapTatkalRefresh);
    if (a = document.getElementById("refresh")) void 0 == b ? (chrome.storage.local.set({
        irctcZapTatkalRefresh: !0
    }), a.checked = !0) : a.checked = b ? !0 : !1
}

function initializeFormList(a) {
    if (a) {
        var a = a.ztFormList,
            b = document.getElementById("formsContainer"),
            f = 0;
        if (a)
            for (var g in a)
                if (a.hasOwnProperty(g)) {
                    var d = b.children[f];
                    if (d) {
                        ++f;
                        var c = d.children[0];
                        if (c) {
                            c.dataset.id = g;
                            c.addEventListener("click", changeSelectedForm);
                            g == selectedFormID ? (selectedFormButton = c, c.classList.add("active")) : c.classList.contains("active") && c.classList.remove("active");
                            var e = d.children[1];
                            if (e && (e.classList.contains("active") && e.classList.remove("active"), d = d.children[2])) d.innerHTML =
                                "<span>" + (a[g] || "") + "</span>", c.addEventListener("mouseover", showToolTip), c.addEventListener("mouseout", hideToolTip)
                        }
                    }
                }
        for (; 6 > f; ++f)
            if (d = b.children[f])
                if (c = d.children[0]) c.classList.contains("active") && c.classList.remove("active"), (e = d.children[1]) && (e.classList.contains("active") || e.classList.add("active"))
    }
}

function showToolTip(a) {
    (a = a.target.parentNode) && a.children[2] && a.children[2].classList.add("active")
}

function hideToolTip(a) {
    (a = a.target.parentNode) && a.children[2] && a.children[2].classList.remove("active")
}

function changeSelectedForm(a) {
    var b = a.target.dataset.id;
    b != selectedFormID && (chrome.storage.local.set({
        selectedForm: b
    }), a.target.classList.add("active"), selectedFormButton && selectedFormButton.classList.remove("active"), selectedFormID = b, selectedFormButton = a.target)
}

function initializeForm(a) {
    a && (selectedFormID = a.selectedForm, chrome.storage.local.get("ztFormList", initializeFormList))
};